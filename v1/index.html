<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard CGU/TCU</title>

  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Regras para legibilidade e evitar “quebra de letras” */
    table { border-collapse: collapse; width: 100%; }
    th, td { padding: .60rem .7rem; border-bottom: 1px solid #e5e7eb; vertical-align: top; }
    th { font-weight: 600; color: #374151; background:#f9fafb; }
    td { white-space: normal; word-break: normal; overflow-wrap: anywhere; }
    .card { background:#fff; border-radius: .75rem; box-shadow: 0 1px 2px rgba(0,0,0,.06); }
    .title { font-size: 1.875rem; line-height: 2.25rem; font-weight: 700; }
    .muted { color:#6b7280 }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <main class="max-w-7xl mx-auto px-4 py-8">
    <header class="mb-6">
      <h1 class="title">Dashboard CGU/TCU</h1>
      <p class="muted text-sm mt-1">
        Tema: <span id="theme">—</span> · Gerado em: <span id="genAt">—</span>
      </p>
    </header>

    <section class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- CGU -->
      <div class="card p-4">
        <h2 class="font-semibold text-lg mb-3">CGU (Top 10)</h2>
        <div class="overflow-x-auto">
          <table id="tbl-cgu">
            <thead>
              <tr>
                <th>Título</th>
                <th>Data</th>
                <th>Município</th>
                <th>Unidade Auditada</th>
                <th>Órgão</th>
                <th>Tipo de Serviço</th>
                <th>Link</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- TCU -->
      <div class="card p-4">
        <h2 class="font-semibold text-lg mb-3">TCU (Top 10)</h2>
        <div class="overflow-x-auto">
          <table id="tbl-tcu">
            <thead>
              <tr>
                <th>Título</th>
                <th>Ano</th>
                <th>Assunto</th>
                <th>Endereço</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <script>
    // Lê ?data=<url> ou usa ./data.json no mesmo diretório
    const u = new URL(location.href);
    const dataUrl = u.searchParams.get('data') || './data.json';

    fetch(dataUrl)
      .then(r => r.json())
      .then(data => render(data))
      .catch(err => {
        document.getElementById('theme').textContent = 'Erro ao carregar';
        console.error('Erro carregando JSON:', err);
      });

    function render(d) {
      // Header
      document.getElementById('theme').textContent = d.theme ?? '—';
      const dt = d.generatedAt ? new Date(d.generatedAt) : null;
      document.getElementById('genAt').textContent = dt && !isNaN(dt) 
        ? dt.toLocaleString('pt-BR') 
        : '—';

      // Helpers
      const cgu = Array.isArray(d.cgu) ? d.cgu.slice(0, 10) : [];
      const tcu = Array.isArray(d.tcu) ? d.tcu.slice(0, 10) : [];

      // Monta CGU
      const cguTbody = document.querySelector('#tbl-cgu tbody');
      cguTbody.innerHTML = cgu.map(i => tr([
        safe(i['Título']),
        safe(i['Data']),
        safe(i['Município']),
        safe(i['Unidade Auditada']),
        safe(i['Órgão']),
        safe(i['Tipo de Serviço']),
        link(i['Link'])
      ])).join('');

      // Monta TCU
      const tcuTbody = document.querySelector('#tbl-tcu tbody');
      tcuTbody.innerHTML = tcu.map(i => tr([
        safe(i['Título']),
        safe(i['Ano']),
        safe(i['Assunto']),
        link(i['Endereço'])
      ])).join('');
    }

    // Utilitários de célula
    const esc = s => String(s ?? '').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));
    const safe = v => esc(v);
    const link = url => {
      const u = (url || '').toString().trim();
      if (!u) return '';
      return `<a href="${esc(u)}" target="_blank" class="text-indigo-600 hover:underline">Abrir</a>`;
    }
    const td = html => `<td>${html}</td>`;
    const tr = cells => `<tr>${cells.map(td).join('')}</tr>`;
  </script>
</body>
</html>
